{
  "aspects": [
    {
      "id": "GREEN",
      "color": "#2a850c",
      "constraints": []
    },
    {
      "id": "YELLOW",
      "color": "#f08a05",
      "constraints": [
        {
          "type": "speed_limit",
          "speed": 8.33333333333333,
          "applies_at": {
            "element": "NEXT_SIGNAL",
            "offset": -100
          },
          "until": {
            "element": "NEXT_SIGNAL",
            "offset": 0
          }
        }
      ]
    },
    {
      "id": "RED",
      "color": "#db0c04",
      "constraints": [
        {
          "type": "speed_limit",
          "speed": 0,
          "applies_at": {
            "element": "CURRENT_SIGNAL",
            "offset": -5
          },
          "until": {
            "element": "END",
            "offset": 0
          }
        }
      ]
    }
  ],
  "operational_points": [],
  "routes": [
    {
      "id": "rt.0-0",
      "entry_point": "tde.0_BEGIN_NORMAL",
      "release_groups": [
        [
          "tvd.0"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.0-0",
      "entry_point": "tde.0_END_REVERSE",
      "release_groups": [
        [
          "tvd.0"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.1-1",
      "entry_point": "tde.1_BEGIN_NORMAL",
      "release_groups": [
        [
          "tvd.1"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.1-1",
      "entry_point": "tde.1_END_REVERSE",
      "release_groups": [
        [
          "tvd.1"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.2-2",
      "entry_point": "tde.2_BEGIN_NORMAL",
      "release_groups": [
        [
          "tvd.2"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.2-2",
      "entry_point": "tde.2_END_REVERSE",
      "release_groups": [
        [
          "tvd.2"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.3-3",
      "entry_point": "tde.3_BEGIN_NORMAL",
      "release_groups": [
        [
          "tvd.3"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.3-3",
      "entry_point": "tde.3_END_REVERSE",
      "release_groups": [
        [
          "tvd.3"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.0-1",
      "entry_point": "tde.0_BEGIN_REVERSE",
      "release_groups": [
        [
          "tvd.0-1"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.1-0",
      "entry_point": "tde.1_BEGIN_REVERSE",
      "release_groups": [
        [
          "tvd.0-1"
        ]
      ],
      "switches_position": {}
    },
    {
      "id": "rt.1-2",
      "entry_point": "tde.1_END_NORMAL",
      "release_groups": [
        [
          "tvd.1-2-3"
        ]
      ],
      "switches_position": {
        "il.switch.1-2-3": "LEFT"
      }
    },
    {
      "id": "rt.1-3",
      "entry_point": "tde.1_END_NORMAL",
      "release_groups": [
        [
          "tvd.1-2-3"
        ]
      ],
      "switches_position": {
        "il.switch.1-2-3": "RIGHT"
      }
    },
    {
      "id": "rt.2-1",
      "entry_point": "tde.2_BEGIN_REVERSE",
      "release_groups": [
        [
          "tvd.1-2-3"
        ]
      ],
      "switches_position": {
        "il.switch.1-2-3": "LEFT"
      }
    },
    {
      "id": "rt.3-1",
      "entry_point": "tde.3_BEGIN_REVERSE",
      "release_groups": [
        [
          "tvd.1-2-3"
        ]
      ],
      "switches_position": {
        "il.switch.1-2-3": "RIGHT"
      }
    }
  ],
  "script_functions": [
    {
      "name": "sncf_filter",
      "arguments": [
        {
          "type": "ASPECT_SET",
          "name": "aspects"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "condition",
        "if": {
          "type": "aspect_set_contains",
          "aspect_set": {
            "type": "argument_ref",
            "argument_name": "aspects"
          },
          "aspect": "RED"
        },
        "then": {
          "type": "aspect_set",
          "members": [
            {
              "aspect": "RED"
            }
          ]
        },
        "else": {
          "type": "condition",
          "if": {
            "type": "aspect_set_contains",
            "aspect_set": {
              "type": "argument_ref",
              "argument_name": "aspects"
            },
            "aspect": "YELLOW"
          },
          "then": {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "YELLOW"
              }
            ]
          },
          "else": {
            "type": "argument_ref",
            "argument_name": "aspects"
          }
        }
      }
    },
    {
      "name": "warn_signal",
      "arguments": [
        {
          "type": "SIGNAL",
          "name": "master_signal"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "call",
        "function": "sncf_filter",
        "arguments": [
          {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "YELLOW",
                "condition": {
                  "type": "signal_has_aspect",
                  "signal": {
                    "type": "argument_ref",
                    "argument_name": "master_signal"
                  },
                  "aspect": "RED"
                }
              },
              {
                "aspect": "GREEN"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "check_route",
      "arguments": [
        {
          "type": "ROUTE",
          "name": "route"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "condition",
        "if": {
          "type": "or",
          "exprs": [
            {
              "type": "route_has_state",
              "route": {
                "type": "argument_ref",
                "argument_name": "route"
              },
              "state": "OCCUPIED"
            },
            {
              "type": "route_has_state",
              "route": {
                "type": "argument_ref",
                "argument_name": "route"
              },
              "state": "REQUESTED"
            },
            {
              "type": "route_has_state",
              "route": {
                "type": "argument_ref",
                "argument_name": "route"
              },
              "state": "CONFLICT"
            }
          ]
        },
        "then": {
          "type": "aspect_set",
          "members": [
            {
              "aspect": "RED"
            }
          ]
        },
        "else": {
          "type": "aspect_set",
          "members": [
            {
              "aspect": "YELLOW"
            }
          ]
        }
      }
    },
    {
      "name": "bal3_line_signal",
      "arguments": [
        {
          "type": "SIGNAL",
          "name": "master_signal"
        },
        {
          "type": "ROUTE",
          "name": "route"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "call",
        "function": "sncf_filter",
        "arguments": [
          {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "RED",
                "condition": {
                  "type": "not",
                  "expr": {
                    "type": "route_has_state",
                    "route": {
                      "type": "argument_ref",
                      "argument_name": "route"
                    },
                    "state": "RESERVED"
                  }
                }
              },
              {
                "aspect": "YELLOW",
                "condition": {
                  "type": "signal_has_aspect",
                  "signal": {
                    "type": "argument_ref",
                    "argument_name": "master_signal"
                  },
                  "aspect": "RED"
                }
              },
              {
                "aspect": "GREEN"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "switch_signal",
      "arguments": [
        {
          "type": "SWITCH",
          "name": "switch"
        },
        {
          "type": "ROUTE",
          "name": "left_route"
        },
        {
          "type": "ROUTE",
          "name": "right_route"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "match",
        "expr": {
          "type": "argument_ref",
          "argument_name": "switch"
        },
        "branches": {
          "LEFT": {
            "type": "call",
            "function": "check_route",
            "arguments": [
              {
                "type": "argument_ref",
                "argument_name": "left_route"
              }
            ]
          },
          "RIGHT": {
            "type": "call",
            "function": "check_route",
            "arguments": [
              {
                "type": "argument_ref",
                "argument_name": "right_route"
              }
            ]
          },
          "MOVING": {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "RED"
              }
            ]
          }
        }
      }
    }
  ],
  "speed_sections": [
    {
      "id": "speedsection.mid_limit",
      "is_signalized": true,
      "speed": 16.666666666666668
    }
  ],
  "switches": [
    {
      "base": {
        "endpoint": "END",
        "section": "1"
      },
      "left": {
        "endpoint": "BEGIN",
        "section": "2"
      },
      "right": {
        "endpoint": "BEGIN",
        "section": "3"
      },
      "id": "il.switch.1-2-3",
      "position_change_delay": 6
    }
  ],
  "track_section_links": [
    {
      "begin": {
        "endpoint": "BEGIN",
        "section": "0"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "1"
      },
      "navigability": "BOTH"
    },
    {
      "begin": {
        "endpoint": "END",
        "section": "1"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "2"
      },
      "navigability": "BOTH"
    },
    {
      "begin": {
        "endpoint": "END",
        "section": "1"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "3"
      },
      "navigability": "BOTH"
    }
  ],
  "track_sections": [
    {
      "id": "0",
      "length": 1000,
      "operational_points": [],
      "route_waypoints": [
        {
          "type": "detector",
          "id": "tde.0_BEGIN_NORMAL",
          "application_directions": "NORMAL",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.0_BEGIN_REVERSE",
          "application_directions": "REVERSE",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.0_END_NORMAL",
          "application_directions": "NORMAL",
          "position": 900
        },
        {
          "type": "detector",
          "id": "tde.0_END_REVERSE",
          "application_directions": "REVERSE",
          "position": 900
        },
        {
          "type": "buffer_stop",
          "application_directions": "REVERSE",
          "id": "stop.0_REVERSE",
          "position": 0
        }
      ],
      "signals": [
        {
          "expr": {
            "type": "call",
            "function": "check_route",
            "arguments": [
              {
                "type": "route",
                "route": "rt.0-0"
              }
            ]
          },
          "id": "il.sig.bal3.pt.0_BEGIN-pt.0_END",
          "linked_detector": "tde.0_BEGIN_NORMAL",
          "position": 75,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.0_BEGIN-pt.1_BEGIN"
              },
              {
                "type": "route",
                "route": "rt.0-0"
              }
            ]
          },
          "id": "il.sig.bal3.pt.0_END-pt.0_BEGIN",
          "linked_detector": "tde.0_END_REVERSE",
          "position": 925,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.1_BEGIN-pt.1_END"
              },
              {
                "type": "route",
                "route": "rt.0-1"
              }
            ]
          },
          "id": "il.sig.bal3.pt.0_BEGIN-pt.1_BEGIN",
          "linked_detector": "tde.0_BEGIN_REVERSE",
          "position": 125,
          "sight_distance": 400
        }
      ]
    },
    {
      "id": "1",
      "length": 1000,
      "operational_points": [],
      "route_waypoints": [
        {
          "type": "detector",
          "id": "tde.1_BEGIN_NORMAL",
          "application_directions": "NORMAL",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.1_BEGIN_REVERSE",
          "application_directions": "REVERSE",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.1_END_NORMAL",
          "application_directions": "NORMAL",
          "position": 900
        },
        {
          "type": "detector",
          "id": "tde.1_END_REVERSE",
          "application_directions": "REVERSE",
          "position": 900
        }
      ],
      "signals": [
        {
          "expr": {
            "type": "call",
            "function": "switch_signal",
            "arguments": [
              {
                "type": "switch",
                "switch": "il.switch.1-2-3"
              },
              {
                "type": "route",
                "route": "rt.1-2"
              },
              {
                "type": "route",
                "route": "rt.1-3"
              }
            ]
          },
          "id": "il.sig.switch.1-2-3",
          "linked_detector": "tde.1_END_NORMAL",
          "applicable_direction": "NORMAL",
          "position": 875,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.1_END-pt.2_BEGIN"
              },
              {
                "type": "route",
                "route": "rt.1-1"
              }
            ]
          },
          "id": "il.sig.bal3.pt.1_BEGIN-pt.1_END",
          "linked_detector": "tde.1_BEGIN_NORMAL",
          "position": 75,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.1_BEGIN-pt.0_BEGIN"
              },
              {
                "type": "route",
                "route": "rt.1-1"
              }
            ]
          },
          "id": "il.sig.bal3.pt.1_END-pt.1_BEGIN",
          "linked_detector": "tde.1_END_REVERSE",
          "position": 925,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.0_BEGIN-pt.0_END"
              },
              {
                "type": "route",
                "route": "rt.1-0"
              }
            ]
          },
          "id": "il.sig.bal3.pt.1_BEGIN-pt.0_BEGIN",
          "linked_detector": "tde.1_BEGIN_REVERSE",
          "position": 125,
          "sight_distance": 400
        }
      ]
    },
    {
      "id": "2",
      "length": 1000,
      "operational_points": [],
      "route_waypoints": [
        {
          "type": "detector",
          "id": "tde.2_BEGIN_NORMAL",
          "application_directions": "NORMAL",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.2_BEGIN_REVERSE",
          "application_directions": "REVERSE",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.2_END_NORMAL",
          "application_directions": "NORMAL",
          "position": 900
        },
        {
          "type": "detector",
          "id": "tde.2_END_REVERSE",
          "application_directions": "REVERSE",
          "position": 900
        },
        {
          "type": "buffer_stop",
          "application_directions": "REVERSE",
          "id": "stop.2_REVERSE",
          "position": 0
        }
      ],
      "signals": [
        {
          "expr": {
            "type": "call",
            "function": "check_route",
            "arguments": [
              {
                "type": "route",
                "route": "rt.2-2"
              }
            ]
          },
          "id": "il.sig.bal3.pt.2_BEGIN-pt.2_END",
          "linked_detector": "tde.2_BEGIN_NORMAL",
          "position": 75,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.2_BEGIN-pt.1_END"
              },
              {
                "type": "route",
                "route": "rt.2-2"
              }
            ]
          },
          "id": "il.sig.bal3.pt.2_END-pt.2_BEGIN",
          "linked_detector": "tde.2_END_REVERSE",
          "position": 925,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.bal3.pt.1_END-pt.1_BEGIN"
              },
              {
                "type": "route",
                "route": "rt.2-1"
              }
            ]
          },
          "id": "il.sig.bal3.pt.2_BEGIN-pt.1_END",
          "linked_detector": "tde.2_BEGIN_REVERSE",
          "position": 125,
          "sight_distance": 400
        }
      ]
    },
    {
      "id": "3",
      "length": 1000,
      "operational_points": [],
      "route_waypoints": [
        {
          "type": "detector",
          "id": "tde.3_BEGIN_NORMAL",
          "application_directions": "NORMAL",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.3_BEGIN_REVERSE",
          "application_directions": "REVERSE",
          "position": 100
        },
        {
          "type": "detector",
          "id": "tde.3_END_NORMAL",
          "application_directions": "NORMAL",
          "position": 900
        },
        {
          "type": "detector",
          "id": "tde.3_END_REVERSE",
          "application_directions": "REVERSE",
          "position": 900
        },
        {
          "type": "buffer_stop",
          "application_directions": "REVERSE",
          "id": "stop.3_REVERSE",
          "position": 0
        }
      ],
      "signals": [
        {
          "expr": {
            "type": "call",
            "function": "check_route",
            "arguments": [
              {
                "type": "route",
                "route": "rt.3-3"
              }
            ]
          },
          "id": "il.sig.bal3.pt.3_BEGIN-pt.3_END",
          "linked_detector": "tde.3_BEGIN_NORMAL",
          "position": 75,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.switch.3-2-2"
              },
              {
                "type": "route",
                "route": "rt.3-3"
              }
            ]
          },
          "id": "il.sig.bal3.pt.3_END-pt.3_BEGIN",
          "linked_detector": "tde.3_END_REVERSE",
          "position": 925,
          "sight_distance": 400
        },
        {
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "il.sig.switch.1-1-2"
              },
              {
                "type": "route",
                "route": "rt.3-1"
              }
            ]
          },
          "id": "il.sig.bal3.pt.3_BEGIN-pt.1_END",
          "linked_detector": "tde.3_BEGIN_REVERSE",
          "position": 125,
          "sight_distance": 400
        }
      ]
    }
  ],
  "tvd_sections": [
    {
      "id": "tvd.0",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.0_BEGIN_NORMAL",
        "tde.0_END_REVERSE"
      ],
      "buffer_stops": []
    },
    {
      "id": "tvd.1",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.1_BEGIN_NORMAL",
        "tde.1_END_REVERSE"
      ],
      "buffer_stops": []
    },
    {
      "id": "tvd.2",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.2_BEGIN_NORMAL",
        "tde.2_END_REVERSE"
      ],
      "buffer_stops": []
    },
    {
      "id": "tvd.3",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.3_BEGIN_NORMAL",
        "tde.3_END_REVERSE"
      ],
      "buffer_stops": []
    },
    {
      "id": "tvd.0-1",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.0_BEGIN_REVERSE",
        "tde.1_BEGIN_REVERSE"
      ],
      "buffer_stops": []
    },
    {
      "id": "tvd.1-2-3",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.1_END_NORMAL",
        "tde.2_BEGIN_REVERSE",
        "tde.3_BEGIN_REVERSE"
      ],
      "buffer_stops": []
    }
  ],
  "version": "1"
}